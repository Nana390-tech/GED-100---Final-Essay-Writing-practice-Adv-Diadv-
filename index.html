!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Essay Builder - Advantage & Disadvantage Essays</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 900px; margin: 0 auto; }

        /* Header */
        .header {
            background: white;
            border-radius: 16px;
            padding: 30px;
            text-align: center;
            margin-bottom: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
        }
        .header h1 {
            font-size: 2rem;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 8px;
        }
        .header p { color: #6b7280; font-size: 1rem; }
        .header .badge {
            display: inline-block;
            background: #ede9fe;
            color: #7c3aed;
            padding: 4px 14px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
            margin-top: 10px;
        }

        /* Topic Grid */
        .topics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }
        .topic-card {
            background: white;
            border-radius: 14px;
            padding: 22px 18px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
            border: 3px solid transparent;
        }
        .topic-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.15); }
        .topic-card.selected { border-color: #7c3aed; background: #f5f3ff; }
        .topic-card .emoji { font-size: 2.2rem; margin-bottom: 10px; display: block; }
        .topic-card .title { font-weight: 700; color: #1f2937; font-size: 0.95rem; }

        /* Color accents for cards */
        .topic-card:nth-child(1) { border-top: 4px solid #ef4444; }
        .topic-card:nth-child(2) { border-top: 4px solid #f59e0b; }
        .topic-card:nth-child(3) { border-top: 4px solid #3b82f6; }
        .topic-card:nth-child(4) { border-top: 4px solid #10b981; }
        .topic-card:nth-child(5) { border-top: 4px solid #8b5cf6; }
        .topic-card:nth-child(6) { border-top: 4px solid #ec4899; }
        .topic-card:nth-child(7) { border-top: 4px solid #14b8a6; }
        .topic-card:nth-child(8) { border-top: 4px solid #f97316; }

        /* Writing Area */
        .writing-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            margin-bottom: 24px;
            display: none;
        }
        .writing-panel.active { display: block; }
        .writing-panel h2 {
            font-size: 1.4rem;
            color: #1f2937;
            margin-bottom: 6px;
        }
        .writing-panel .topic-label {
            color: #7c3aed;
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 16px;
        }
        .writing-panel .instructions {
            background: #fef3c7;
            border-left: 4px solid #f59e0b;
            padding: 14px 18px;
            border-radius: 8px;
            margin-bottom: 18px;
            font-size: 0.92rem;
            color: #92400e;
            line-height: 1.6;
        }
        .essay-textarea {
            width: 100%;
            min-height: 280px;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 16px;
            font-size: 1rem;
            line-height: 1.7;
            resize: vertical;
            font-family: inherit;
            transition: border-color 0.3s;
        }
        .essay-textarea:focus { outline: none; border-color: #7c3aed; }
        .word-count {
            text-align: right;
            margin-top: 8px;
            font-size: 0.88rem;
            color: #6b7280;
        }
        .word-count.low { color: #ef4444; }
        .word-count.good { color: #10b981; }

        /* Buttons */
        .btn-row {
            display: flex;
            gap: 12px;
            margin-top: 18px;
            flex-wrap: wrap;
        }
        .btn {
            padding: 12px 28px;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        .btn:hover { transform: translateY(-2px); }
        .btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }
        .btn-primary { background: linear-gradient(135deg, #7c3aed, #6366f1); color: white; }
        .btn-primary:hover:not(:disabled) { box-shadow: 0 6px 20px rgba(124,58,237,0.4); }
        .btn-green { background: linear-gradient(135deg, #10b981, #059669); color: white; }
        .btn-green:hover:not(:disabled) { box-shadow: 0 6px 20px rgba(16,185,129,0.4); }
        .btn-orange { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .btn-orange:hover:not(:disabled) { box-shadow: 0 6px 20px rgba(245,158,11,0.4); }
        .btn-gray { background: #e5e7eb; color: #374151; }
        .btn-gray:hover:not(:disabled) { background: #d1d5db; }
        .btn-print { background: linear-gradient(135deg, #3b82f6, #2563eb); color: white; }
        .btn-print:hover:not(:disabled) { box-shadow: 0 6px 20px rgba(59,130,246,0.4); }

        /* Feedback Panel */
        .feedback-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            margin-bottom: 24px;
            display: none;
        }
        .feedback-panel.active { display: block; }
        .feedback-panel h2 { font-size: 1.4rem; color: #1f2937; margin-bottom: 18px; }
        .feedback-section {
            background: #f9fafb;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 16px;
        }
        .feedback-section h3 {
            font-size: 1.05rem;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .feedback-section p, .feedback-section ul {
            font-size: 0.95rem;
            color: #374151;
            line-height: 1.7;
        }
        .feedback-section ul { padding-left: 20px; }
        .feedback-section li { margin-bottom: 6px; }
        .grammar-section h3 { color: #dc2626; }
        .vocab-section h3 { color: #2563eb; }
        .task-section h3 { color: #059669; }
        .tips-section h3 { color: #d97706; }

        /* Sample Answer */
        .sample-panel {
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.15);
            margin-bottom: 24px;
            display: none;
        }
        .sample-panel.active { display: block; }
        .sample-panel h2 { font-size: 1.4rem; color: #1f2937; margin-bottom: 18px; }
        .sample-essay {
            background: #f0fdf4;
            border-left: 4px solid #10b981;
            padding: 20px;
            border-radius: 8px;
            font-size: 0.95rem;
            line-height: 1.8;
            color: #1f2937;
            white-space: pre-wrap;
        }

        /* Loading spinner */
        .loading {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 20px;
            color: #7c3aed;
            font-weight: 600;
        }
        .spinner {
            width: 28px; height: 28px;
            border: 3px solid #e5e7eb;
            border-top-color: #7c3aed;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
        }
        @keyframes spin { to { transform: rotate(360deg); } }

        /* Print Styles */
        @media print {
            body { background: white; padding: 0; }
            .no-print { display: none !important; }
            .header, .writing-panel, .feedback-panel, .sample-panel {
                box-shadow: none;
                break-inside: avoid;
            }
            .container { max-width: 100%; }
        }

        /* Back button */
        .back-link {
            color: white;
            font-size: 0.95rem;
            cursor: pointer;
            margin-bottom: 12px;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            opacity: 0.9;
        }
        .back-link:hover { opacity: 1; text-decoration: underline; }

        /* Responsive */
        @media (max-width: 600px) {
            .topics-grid { grid-template-columns: repeat(2, 1fr); }
            .btn-row { flex-direction: column; }
            .btn { width: 100%; justify-content: center; }
        }
    </style>
</head>
<body>

<div class="container" id="app"></div>

<script>
const TOPICS = [
    { id: 1, emoji: 'üèôÔ∏è', title: 'City Life vs Village Life', prompt: 'living in a city compared to living in a village' },
    { id: 2, emoji: 'üìö', title: 'Homework', prompt: 'homework for students' },
    { id: 3, emoji: 'üì±', title: 'Social Media', prompt: 'using social media' },
    { id: 4, emoji: 'üì≤', title: 'Smartphones', prompt: 'using smartphones' },
    { id: 5, emoji: 'üõí', title: 'Online Shopping', prompt: 'online shopping' },
    { id: 6, emoji: 'üçî', title: 'Fast Food', prompt: 'eating fast food' },
    { id: 7, emoji: '‚öΩ', title: 'Team Sports', prompt: 'playing team sports' },
    { id: 8, emoji: 'üíº', title: 'Part-Time Work', prompt: 'students having part-time jobs' }
];

let state = {
    screen: 'topics', // topics | writing | feedback | sample
    selectedTopic: null,
    essay: '',
    feedback: null,
    sample: null,
    loadingFeedback: false,
    loadingSample: false
};

function countWords(text) {
    return text.trim() ? text.trim().split(/\s+/).length : 0;
}

function render() {
    const app = document.getElementById('app');
    if (state.screen === 'topics') renderTopics(app);
    else if (state.screen === 'writing') renderWriting(app);
}

function renderTopics(app) {
    app.innerHTML = `
        <div class="header">
            <h1>‚úçÔ∏è Essay Builder</h1>
            <p>Learn to write advantage & disadvantage essays</p>
            <span class="badge">A2+ Level</span>
        </div>
        <div class="topics-grid">
            ${TOPICS.map(t => `
                <div class="topic-card" onclick="selectTopic(${t.id})">
                    <span class="emoji">${t.emoji}</span>
                    <span class="title">${t.title}</span>
                </div>
            `).join('')}
        </div>
    `;
}

function selectTopic(id) {
    state.selectedTopic = TOPICS.find(t => t.id === id);
    state.essay = '';
    state.feedback = null;
    state.sample = null;
    state.screen = 'writing';
    render();
}

function goBack() {
    state.screen = 'topics';
    state.feedback = null;
    state.sample = null;
    render();
}

function renderWriting(app) {
    const t = state.selectedTopic;
    const wc = countWords(state.essay);
    const wcClass = wc < 100 ? 'low' : 'good';

    app.innerHTML = `
        <div class="back-link no-print" onclick="goBack()">‚Üê Back to Topics</div>
        <div class="header">
            <h1>‚úçÔ∏è Essay Builder</h1>
            <p>Learn to write advantage & disadvantage essays</p>
            <span class="badge">A2+ Level</span>
        </div>

        <div class="writing-panel active">
            <h2>${t.emoji} Write Your Essay</h2>
            <div class="topic-label">Topic: ${t.title}</div>
            <div class="instructions">
                <strong>üìù Instructions:</strong><br>
                Write an essay about the <strong>advantages and disadvantages of ${t.prompt}</strong>.<br><br>
                Your essay should have <strong>4 paragraphs</strong>:<br>
                1Ô∏è‚É£ <strong>Introduction</strong> ‚Äì Introduce the topic<br>
                2Ô∏è‚É£ <strong>Advantages</strong> ‚Äì Give 2-3 advantages with reasons<br>
                3Ô∏è‚É£ <strong>Disadvantages</strong> ‚Äì Give 2-3 disadvantages with reasons<br>
                4Ô∏è‚É£ <strong>Conclusion</strong> ‚Äì Give your opinion<br><br>
                ‚úÖ Try to write <strong>150‚Äì200 words</strong>.
            </div>
            <textarea class="essay-textarea" id="essayInput" placeholder="Write your essay here..."
                oninput="updateEssay(this.value)">${state.essay}</textarea>
            <div class="word-count ${wcClass}">Words: ${wc} / 200</div>
            <div class="btn-row no-print">
                <button class="btn btn-primary" onclick="getFeedback()" ${wc < 30 ? 'disabled' : ''}>
                    üìù Get AI Feedback
                </button>
                <button class="btn btn-green" onclick="getSample()" ${wc < 10 ? 'disabled' : ''}>
                    üìÑ Show Sample Answer
                </button>
                <button class="btn btn-gray" onclick="clearEssay()">üóëÔ∏è Clear</button>
            </div>
        </div>

        <div id="feedbackArea"></div>
        <div id="sampleArea"></div>
    `;

    if (state.loadingFeedback) {
        document.getElementById('feedbackArea').innerHTML = `
            <div class="feedback-panel active"><div class="loading"><div class="spinner"></div> Analyzing your essay...</div></div>`;
    } else if (state.feedback) {
        renderFeedback();
    }

    if (state.loadingSample) {
        document.getElementById('sampleArea').innerHTML = `
            <div class="sample-panel active"><div class="loading"><div class="spinner"></div> Generating sample answer...</div></div>`;
    } else if (state.sample) {
        renderSample();
    }
}

function updateEssay(val) {
    state.essay = val;
    const wc = countWords(val);
    const wcEl = document.querySelector('.word-count');
    if (wcEl) {
        wcEl.textContent = `Words: ${wc} / 200`;
        wcEl.className = 'word-count ' + (wc < 100 ? 'low' : 'good');
    }
    // Enable/disable buttons
    const btns = document.querySelectorAll('.btn-primary, .btn-green');
    if (btns[0]) btns[0].disabled = wc < 30;
    if (btns[1]) btns[1].disabled = wc < 10;
}

function clearEssay() {
    state.essay = '';
    state.feedback = null;
    state.sample = null;
    render();
}

async function getFeedback() {
    state.loadingFeedback = true;
    state.feedback = null;
    render();

    const t = state.selectedTopic;
    try {
        const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "claude-sonnet-4-20250514",
                max_tokens: 1000,
                messages: [{
                    role: "user",
                    content: `You are an English teacher for A2+ level ESL students (Arabic speakers aged 17-24). Analyze this advantage/disadvantage essay about "${t.title}" and provide feedback.

ESSAY:
"""
${state.essay}
"""

Respond ONLY in this JSON format (no markdown, no backticks):
{
    "grammar": {
        "score": 0-10,
        "comments": "Brief feedback on grammar errors. Use simple English. Give 2-3 specific corrections."
    },
    "vocabulary": {
        "score": 0-10,
        "comments": "Brief feedback on word choice. Suggest 2-3 better words they could use. Keep suggestions at A2-B1 level."
    },
    "taskAchievement": {
        "score": 0-10,
        "comments": "Did they include introduction, advantages, disadvantages, and conclusion? Brief feedback."
    },
    "tips": "Give 2-3 simple, encouraging tips to improve. Use simple English suitable for A2+ learners."
}`
                }]
            })
        });
        const data = await response.json();
        const text = data.content.map(i => i.text || '').join('');
        const clean = text.replace(/```json|```/g, '').trim();
        state.feedback = JSON.parse(clean);
    } catch (err) {
        state.feedback = {
            grammar: { score: '-', comments: 'Could not analyze. Please check your internet connection and try again.' },
            vocabulary: { score: '-', comments: '' },
            taskAchievement: { score: '-', comments: '' },
            tips: 'Try again in a moment.'
        };
    }
    state.loadingFeedback = false;
    render();
}

async function getSample() {
    state.loadingSample = true;
    state.sample = null;
    render();

    const t = state.selectedTopic;
    try {
        const response = await fetch("https://api.anthropic.com/v1/messages", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({
                model: "claude-sonnet-4-20250514",
                max_tokens: 1000,
                messages: [{
                    role: "user",
                    content: `You are an English teacher writing a MODEL ANSWER for A2+ level ESL students (Arabic speakers aged 17-24).

Write a sample advantage/disadvantage essay about "${t.title}" (${t.prompt}).

VERY IMPORTANT LANGUAGE RULES - Follow ALL of these:
- Use ONLY simple vocabulary (A2-B1 level)
- Use ONLY basic tenses: present simple, past simple, present continuous, future with "will" or "going to"
- Keep sentences SHORT (max 12-15 words per sentence)
- Use ONLY elementary connecting words: and, but, because, so, also, however, for example, first, second, finally
- Do NOT use complex grammar (no passive voice, no conditionals, no relative clauses)
- Write 150-180 words total
- Use 4 clear paragraphs: Introduction, Advantages, Disadvantages, Conclusion

Write ONLY the essay text with paragraph breaks. No titles, no labels, no extra formatting.`
                }]
            })
        });
        const data = await response.json();
        state.sample = data.content.map(i => i.text || '').join('');
    } catch (err) {
        state.sample = 'Could not generate sample answer. Please check your internet connection and try again.';
    }
    state.loadingSample = false;
    render();
}

function renderFeedback() {
    const f = state.feedback;
    const area = document.getElementById('feedbackArea');
    if (!area) return;
    area.innerHTML = `
        <div class="feedback-panel active">
            <h2>üìù AI Feedback</h2>
            <div class="feedback-section grammar-section">
                <h3>üìñ Grammar (${f.grammar.score}/10)</h3>
                <p>${f.grammar.comments}</p>
            </div>
            <div class="feedback-section vocab-section">
                <h3>üìò Vocabulary (${f.vocabulary.score}/10)</h3>
                <p>${f.vocabulary.comments}</p>
            </div>
            <div class="feedback-section task-section">
                <h3>‚úÖ Task Achievement (${f.taskAchievement.score}/10)</h3>
                <p>${f.taskAchievement.comments}</p>
            </div>
            <div class="feedback-section tips-section">
                <h3>üí° Tips to Improve</h3>
                <p>${f.tips}</p>
            </div>
            <div class="btn-row no-print">
                <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Print Feedback</button>
            </div>
        </div>
    `;
}

function renderSample() {
    const area = document.getElementById('sampleArea');
    if (!area) return;
    area.innerHTML = `
        <div class="sample-panel active">
            <h2>üìÑ Sample Answer ‚Äî ${state.selectedTopic.title}</h2>
            <div class="sample-essay">${state.sample}</div>
            <div class="btn-row no-print">
                <button class="btn btn-print" onclick="window.print()">üñ®Ô∏è Print Sample Answer</button>
            </div>
        </div>
    `;
}

// Initial render
render();
</script>
</body>
</html>
